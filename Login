#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<Windows.h>
#include<conio.h>

#include "SE.h"

typedef struct ADDRESS	// 주소록 정보
{
  char lastName[5];	//성
  char firstName[15];	//(성 제외)이름
  char job[20];		//직책
  char department[20];	//부서
  char company[20];	//회사명
  char homeAddress[60];	//주소
  char homePhone[11];	//전화번호
  char faxNumber[11];	//팩스번호
  char mobilePhone[12];	//휴대전화번호
  char email[40];	//E-mail
  char homepage[50];	//홈페이지
} address;

typedef struct NODE
{
  address *sAddress;
  struct NODE *next;
} node;

node *head;
node *tail;

FILE* fp = NULL;
char buff[passwordSize+1];
char inputPassword[passwordSize+1];

void listAddress();
void addAddress();
void modifyAddress();
void deleteAddress();
void findAddress();
void changePassword();
void Logout();
int printMainMenu()

int main(void)
{
	int login;
	int menuChoice = 0;

	fp = fopen("address_book.txt","r+");
	if(fp == NULL) {
		printf("일치하는 주소록이 없습니다.\n");
		return ;}
	fgets(buff, sizeof(int)*passwordSize, fp);
		
	printf("주소록 시스템에 오신걸 환영합니다.\n\n");

	do { login = Login(); }while( login == FALSE );

	printf("로그인에 성공하였습니다!\n\n");
		
	while( login == TRUE && menuChoice != 8 ) 
	{
		menuChoice = printMainMenu();
		if(!(menuChoice >=1 && menuChoice <=8))
		{
			continue;
		}
		
		switch(menuChoice) 
		{
		case 1: 
		  listAddress(); //주소록 전체보기
		  break;
		case 2: 
		  addAddress(); //주소록 추가
		  break;
		case 3: 
		  modifyAddress(); //주소록 수정
		  break;
		case 4: 
		  deleteAddress(); //주소록 삭제
		  break;
		case 5: 
		  findAddress(); //주소록 검색
		  break;
		case 6: 
		  changePassword(); //비밀번호 변경
		  break;
		case 7: 
		  Logout(); //로그아웃
		  break;
		case 8: 
		  exit(1); //종료
		  break;
		default: printf("잘못 입력하셨습니다.\n");
		}
	}

	fclose(fp);
	return 0;
}

int Login()
{	
	printf("사용자의 비밀번호를 입력하세요: ");
	gets(inputPassword);

	while( IsValidPassword() == FALSE ) {
		printf("비밀번호는 네 자리로 입력해주세요\n");
		printf("사용자의 비밀번호를 입력하세요: ");
		gets(inputPassword); }

	if( strcmp(buff,inputPassword) != 0 ) {
		printf("비밀번호가 일치하지 않습니다.\n");
		return FALSE; }
	else return TRUE;

}

int IsValidPassword()
{
	int isValid;
	
	if(strlen(inputPassword) != passwordSize)
		isValid = FALSE;
	else isValid = TRUE;

	return isValid;
}

void listAddress()
{
	node *p1;
	node *p2;
	node *p3;
	int count = 0;
	int i, j;
	
	p1 = head->next;
	while(p1 !=tail)	//총 주소록 수 구하기
	{
		count++;
		p1 = p1->next;
	}
	
	for(i=1; i<count; i++)
	{
		p1 = head;
		p2 = head->next;
		p3 = p2->next;
		
		for(j=1; j<=(count-1); j++)
		{
			if(strcmp(p2->sAddress, p3->sAddress) < 0)	//문자열 비교(오름차순)
			{
				p2->next = p3->next;
				p3->next = p2;
				p1->next = p3;
				p1 = p3;
				p3 = p2->next;
			}
			else
			{
				p1 = p2;
				p2 = p3;
				p3 = p3->next;
			}
		}
	}
	system("cls");
	printf("주소록 전체보기\n");
	
}
void addAddress()
{
	node *t;
	address *pAddress;
	char temp;
	char lastName[5];	//성
	char firstName[15];	//(성 제외)이름
	char job[20];		//직책
	char department[20];	//부서
	char company[20];	//회사명
	char homeAddress[60];	//주소
	char homePhone[11];	//전화번호
	char faxNumber[11];	//팩스번호
	char mobilePhone[12];	//휴대전화번호
	char email[40];		//E-mail
	char homepage[50];	//홈페이지
	
	t = (node *)malloc(sizeof(node));
	pAddress = (address *)malloc(sizeof(address));
	
	system("cls");
	print("주소록 추가\n");
	printf("----------------------------------\n");
	printf("1. 성 : "); scanf("%s", pAddress->lastName);
	printf("2. (성 제외) 이름 : "); scanf("%s", pAddress->firstName);
	printf("3. 직책 : "); scanf("%s", pAddress->job);
	printf("4. 부서 : "); scanf("%s", pAddress->department);
	printf("5. 회사명 : "); scanf("%s", pAddress->company);
	printf("6. 주소 : "); scanf("%s", pAddress->homeAddress);
	printf("7. 전화번호 : "); scanf("%s", pAddress->homePhone);
	printf("8. 팩스번호 : "); scanf("%s", pAddress->faxNumber);
	printf("9. 휴대전화번호 : "); scanf("%s", pAddress->mobilePhone);
	printf("10. E-mail : "); scanf("%s", pAddress->email);
	printf("11. 홈페이지 : "); scanf("%s", pAddress->homepage);
	printf("----------------------------------\n\n");
	
	t->sAddress = pAddress;
	
	printf("정말로 등록하시겠습니까? (y/n) : ");
	temp = getch();
	
	if(temp == 'y' || temp == 'Y')
	{
		if(head->next == tail)
		{
			t->next = tail; //데이터가 없을 경우, head와 tail 사이에 직접 삽입
		}
		else
		{
			t->next = head->next;
		}
		head->next = t;
		system("cls");
		printf("등록이 정상적으로 완료되었습니다.\n");
	}
	else
	{
		free(t);
		free(pAddress);
		system("cls");
		printf("등록을 취소하였습니다.\n");
	}
	Sleep(1000);	//1초(1000) 딜레이	
}

void modifyAddress(){;}
void deleteAddress(){;}
void findAddress(){;}
void changePassword(){;}
void Logout(){;}

int printMainMenu()
{
	int menuChoice;
	system("cls");
	printf("메인 메뉴\n");
	printf("----------------------------------\n");
	printf("1. 주소록 전체보기\n");
	printf("2. 주소록 추가\n");
	printf("3. 주소록 수정\n");
	printf("4. 주소록 삭제\n");
	printf("5. 주소록 검색\n");
	printf("6. 비밀번호 변경\n");
	printf("7. 로그아웃\n");
	printf("8. 종료\n");
	printf("----------------------------------\n\n");
	printf("번호를 입력하세요(1~8) : ");
	scanf("%d", &menuChoice);
	fflush(stdin); //버퍼 삭제
	return menuChoice;
}
